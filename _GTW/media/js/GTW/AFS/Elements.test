/*
Run this like::
    $ /usr/bin/js -s -f GTW/AFS/Elements.test -i

to get an interactive Javascript shell with GTW.js and GTW/AFS/Elements.js
loaded

*/
// Define aliases to allow direct copy/pasting from Python doctest
var False = false, True = true;

load ("GTW.js")
load ("GTW/AFS/Elements.js")
load ("GTW/inspect.js")
load ("GTW/jsonify.js")
var f = new $GTW.AFS.Form (
    { '$id' : 'FB'
    , 'children' :
        [ { '$id' : 'FB-0'
          , 'children' :
              [ { '$id' : 'FB-0:0'
                , 'children' :
                    [ { '$id' : 'FB-0:0:0'
                      , 'children' :
                          [ { '$id' : 'FB-0:0:0:0'
                            , 'name' : 'name'
                            , 'type' : 'Field'
                            , 'ui_name' : 'Name'
                            , 'value' :
                                { 'init' : 'Optimist' }
                            }
                          ]
                      , 'name' : 'left'
                      , 'type' : 'Field_Entity'
                      , 'type_name' : 'GTW.OMP.SRM.Boat_Class'
                      , 'ui_name' : 'Class'
                      , 'value' :
                          { 'init' :
                              { 'cid' : 1
                              , 'pid' : 1
                              }
                          , 'sid' : '4iclb:pX5bjYLJxM-hzFmRyFDlvAtNlJAOqXtg'
                          }
                      }
                    , { '$id' : 'FB-0:0:1'
                      , 'name' : 'nation'
                      , 'type' : 'Field'
                      , 'ui_name' : 'Nation'
                      , 'value' :
                          { 'init' : 'AUT' }
                      }
                    , { '$id' : 'FB-0:0:2'
                      , 'name' : 'sail_number'
                      , 'type' : 'Field'
                      , 'ui_name' : 'Sail number'
                      , 'value' :
                          { 'init' : '1107' }
                      }
                    ]
                , 'collapsed' : False
                , 'name' : 'primary'
                , 'type' : 'Fieldset'
                }
              , { '$id' : 'FB-0:1'
                , 'children' :
                    [ { '$id' : 'FB-0:1:0'
                      , 'name' : 'name'
                      , 'type' : 'Field'
                      , 'ui_name' : 'Name'
                      , 'value' :
                          {}
                      }
                    ]
                , 'collapsed' : True
                , 'name' : 'optional'
                , 'type' : 'Fieldset'
                }
              , { '$id' : 'FB-0:2'
                , 'children' :
                    [ { '$id' : 'FB-0:2::0'
                      , 'children' :
                          [ { '$id' : 'FB-0:2::0-0'
                            , 'children' :
                                [ { '$id' : 'FB-0:2::0-0:0'
                                  , 'children' :
                                      [ { '$id' : 'FB-0:2::0-0:0:0'
                                        , 'children' :
                                            [ { '$id' : 'FB-0:2::0-0:0:0:0'
                                              , 'children' :
                                                  [ { '$id' : 'FB-0:2::0-0:0:0:0.0'
                                                    , 'name' : 'start'
                                                    , 'type' : 'Field'
                                                    , 'ui_name' : 'Start'
                                                    , 'value' :
                                                        { 'init' : '2008/05/01' }
                                                    }
                                                  , { '$id' : 'FB-0:2::0-0:0:0:0.1'
                                                    , 'name' : 'finish'
                                                    , 'type' : 'Field'
                                                    , 'ui_name' : 'Finish'
                                                    , 'value' :
                                                        { 'init' : '2008/05/01' }
                                                    }
                                                  ]
                                              , 'name' : 'date'
                                              , 'type' : 'Field_Composite'
                                              , 'type_name' : 'MOM.Date_Interval_C'
                                              , 'ui_name' : 'Date'
                                              , 'value' :
                                                  {}
                                              }
                                            , { '$id' : 'FB-0:2::0-0:0:0:1'
                                              , 'name' : 'name'
                                              , 'type' : 'Field'
                                              , 'ui_name' : 'Name'
                                              , 'value' :
                                                  { 'init' : 'Himmelfahrt' }
                                              }
                                            ]
                                        , 'name' : 'left'
                                        , 'type' : 'Field_Entity'
                                        , 'type_name' : 'GTW.OMP.SRM.Regatta_Event'
                                        , 'ui_name' : 'Event'
                                        , 'value' :
                                            { 'init' :
                                                { 'cid' : 5
                                                , 'pid' : 5
                                                }
                                            , 'sid' : 'dcxwDqiRZoVQJibrtBp6fHpF-vf-P:Y91evK-w'
                                            }
                                        }
                                      ]
                                  , 'name' : 'right'
                                  , 'type' : 'Field_Entity'
                                  , 'type_name' : 'GTW.OMP.SRM.Regatta'
                                  , 'ui_name' : 'Regatta'
                                  , 'value' :
                                      { 'init' :
                                          { 'cid' : 6
                                          , 'pid' : 6
                                          }
                                      , 'sid' : 'QV0XMZopZtbgxQLnOGxW54o3iDzg6Lu7T0yBbQ'
                                      }
                                  }
                                ]
                            , 'collapsed' : False
                            , 'name' : 'primary'
                            , 'type' : 'Fieldset'
                            }
                          , { '$id' : 'FB-0:2::0-1'
                            , 'children' :
                                [ { '$id' : 'FB-0:2::0-1:0'
                                  , 'children' :
                                      [ { '$id' : 'FB-0:2::0-1:0:0'
                                        , 'children' :
                                            [ { '$id' : 'FB-0:2::0-1:0:0:0'
                                              , 'name' : 'last_name'
                                              , 'type' : 'Field'
                                              , 'ui_name' : 'Last name'
                                              , 'value' :
                                                  { 'init' : 'Tanzer' }
                                              }
                                            , { '$id' : 'FB-0:2::0-1:0:0:1'
                                              , 'name' : 'first_name'
                                              , 'type' : 'Field'
                                              , 'ui_name' : 'First name'
                                              , 'value' :
                                                  { 'init' : 'Laurens' }
                                              }
                                            , { '$id' : 'FB-0:2::0-1:0:0:2'
                                              , 'name' : 'middle_name'
                                              , 'type' : 'Field'
                                              , 'ui_name' : 'Middle name'
                                              , 'value' :
                                                  {}
                                              }
                                            , { '$id' : 'FB-0:2::0-1:0:0:3'
                                              , 'name' : 'title'
                                              , 'type' : 'Field'
                                              , 'ui_name' : 'Academic title'
                                              , 'value' :
                                                  {}
                                              }
                                            ]
                                        , 'name' : 'left'
                                        , 'type' : 'Field_Entity'
                                        , 'type_name' : 'GTW.OMP.PAP.Person'
                                        , 'ui_name' : 'Person'
                                        , 'value' :
                                            { 'init' :
                                                { 'cid' : 3
                                                , 'pid' : 3
                                                }
                                            , 'sid' : 'YK12nZUTcWDXqNvjVEjS9R1p3CcbMqrpo2Lw2g'
                                            }
                                        }
                                      , { '$id' : 'FB-0:2::0-1:0:1'
                                        , 'name' : 'nation'
                                        , 'type' : 'Field'
                                        , 'ui_name' : 'Nation'
                                        , 'value' :
                                            { 'init' : 'AUT' }
                                        }
                                      , { '$id' : 'FB-0:2::0-1:0:2'
                                        , 'name' : 'mna_number'
                                        , 'type' : 'Field'
                                        , 'ui_name' : 'Mna number'
                                        , 'value' :
                                            { 'init' : '29676' }
                                        }
                                      ]
                                  , 'name' : 'skipper'
                                  , 'type' : 'Field_Entity'
                                  , 'type_name' : 'GTW.OMP.SRM.Sailor'
                                  , 'ui_name' : 'Skipper'
                                  , 'value' :
                                      { 'init' :
                                          { 'cid' : 4
                                          , 'pid' : 4
                                          }
                                      , 'sid' : '730ReHYLtxqCywPM1fa-UOFGO8Rs-bmf6sBu3w'
                                      }
                                  }
                                ]
                            , 'collapsed' : True
                            , 'name' : 'required'
                            , 'type' : 'Fieldset'
                            }
                          , { '$id' : 'FB-0:2::0-2'
                            , 'children' :
                                [ { '$id' : 'FB-0:2::0-2:0'
                                  , 'name' : 'place'
                                  , 'type' : 'Field'
                                  , 'ui_name' : 'Place'
                                  , 'value' :
                                      {}
                                  }
                                , { '$id' : 'FB-0:2::0-2:1'
                                  , 'name' : 'points'
                                  , 'type' : 'Field'
                                  , 'ui_name' : 'Points'
                                  , 'value' :
                                      {}
                                  }
                                ]
                            , 'collapsed' : True
                            , 'name' : 'optional'
                            , 'type' : 'Fieldset'
                            }
                          ]
                      , 'name' : 'GTW.OMP.SRM.Boat_in_Regatta'
                      , 'role_name' : 'left'
                      , 'type' : 'Entity_Link'
                      , 'type_name' : 'GTW.OMP.SRM.Boat_in_Regatta'
                      , 'value' :
                          { 'init' :
                              { 'cid' : 7
                              , 'pid' : 7
                              }
                          , 'sid' : '5xjJCTEvzyUM3plZRJ5iNm3HFFkY1nJX0uyuag'
                          }
                      }
                    ]
                , 'type' : 'Entity_List'
                }
              ]
          , 'name' : 'GTW.OMP.SRM.Boat'
          , 'type' : 'Entity'
          , 'type_name' : 'GTW.OMP.SRM.Boat'
          , 'value' :
              { 'init' :
                  { 'cid' : 2
                  , 'pid' : 2
                  }
              , 'sid' : 'P-PZNMardDRUXsk4DoTyB3R3sw:j1xubY7vghA'
              }
          }
        ]
    , 'type' : 'Form'
    , 'value' :
        { 'sid' : 0 }
    }
);

var e = $GTW.AFS.Elements.id_map ["FB-0"];
var l = $GTW.AFS.Elements.id_map ["FB-0:2::0"];
print ("FB-0 value :\n"      + $GTW.inspect.show (e.value, undefined, 1));
print ("FB-0:2::0 value :\n" + $GTW.inspect.show (l.value, undefined, 1));
print ("Form values :\n"     + $GTW.inspect.show (f.packed_values (), undefined, 1));

print ("$GTW :\n" + $GTW.inspect.show ($GTW, undefined, 1));

print ("FB-0:2::0 value jsonified :\n  " + $GTW.jsonify (l.value));
print ("Form values jsonified :\n  " + $GTW.jsonify (f.packed_values ()));

var x = f.get ("FB-0:2::0-1:0:0:2");
x.value.edit = "William";
print
    ( "Form values after change:\n"
    + $GTW.inspect.show (f.packed_values (), undefined, 1)
    );
print
    ( "Form values jsonified after change:\n  "
    + $GTW.jsonify (f.packed_values ())
    );

// __END__ Elements.test
